# docker-compose.workers.dev.yml
# Development override - builds workers locally instead of pulling from GHCR
#
# Usage:
#   docker compose -f docker-compose.workers.yml -f docker-compose.workers.dev.yml up -d --build
#
# This is for local development only. Production should use GHCR images.

x-worker-build: &worker-build
  build:
    context: .
    dockerfile: Dockerfile.worker
    args:
      GIT_SHA: ${GIT_SHA:-dev}
      BUILD_DATE: ${BUILD_DATE:-unknown}
      WITH_OCR: "false"

x-worker-ocr-build: &worker-ocr-build
  build:
    context: .
    dockerfile: Dockerfile.worker
    args:
      GIT_SHA: ${GIT_SHA:-dev}
      BUILD_DATE: ${BUILD_DATE:-unknown}
      WITH_OCR: "true"

services:
  worker-orchestrator:
    <<: *worker-build
    image: fiskai-worker:dev

  worker-sentinel:
    <<: *worker-build
    image: fiskai-worker:dev

  worker-extractor:
    <<: *worker-build
    image: fiskai-worker:dev

  worker-ocr:
    <<: *worker-ocr-build
    image: fiskai-worker-ocr:dev

  worker-composer:
    <<: *worker-build
    image: fiskai-worker:dev

  worker-reviewer:
    <<: *worker-build
    image: fiskai-worker:dev

  worker-scheduler:
    <<: *worker-build
    image: fiskai-worker:dev

  worker-releaser:
    <<: *worker-build
    image: fiskai-worker:dev

  worker-arbiter:
    <<: *worker-build
    image: fiskai-worker:dev

  worker-continuous-drainer:
    <<: *worker-build
    image: fiskai-worker:dev

  worker-content-sync:
    <<: *worker-build
    image: fiskai-worker:dev

  worker-article:
    <<: *worker-build
    image: fiskai-worker:dev

  worker-evidence-embedding:
    <<: *worker-build
    image: fiskai-worker:dev

  worker-embedding:
    <<: *worker-build
    image: fiskai-worker:dev

  worker-einvoice-inbound:
    <<: *worker-build
    image: fiskai-worker:dev
