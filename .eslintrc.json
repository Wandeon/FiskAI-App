{
  "root": true,
  "ignorePatterns": [
    "src/generated/**",
    "src/design-system/eslint/**/*.js",
    "src/design-system/tokens/**",
    "src/design-system/scripts/**",
    "src/emails/**",
    "src/lib/email/templates/**",
    "src/lib/reports/*-pdf.tsx",
    "src/lib/pausalni/forms/*-pdf-template.tsx",
    "src/app/**/*.png/route.tsx",
    "src/lib/pdf/**",
    "src/styles/tokens.ts",
    "src/lib/admin/weekly-digest-format.ts",
    "src/lib/__tests__/**",
    "src/lib/compliance/certificate-monitor.ts",
    "src/lib/regulatory-truth/watchdog/resend-email.tsx"
  ],
  "extends": ["next/core-web-vitals", "next/typescript"],
  "plugins": ["fisk-design-system", "import"],
  "parserOptions": {
    "project": "./tsconfig.json"
  },
  "settings": {
    "import/resolver": {
      "typescript": {
        "alwaysTryTypes": true
      }
    }
  },
  "rules": {
    "@typescript-eslint/no-floating-promises": "error",
    "@typescript-eslint/no-misused-promises": [
      "error",
      {
        "checksVoidReturn": {
          "attributes": false
        }
      }
    ],
    "@typescript-eslint/no-explicit-any": "error",
    "import/no-restricted-paths": [
      "error",
      {
        "basePath": "./src",
        "zones": [
          {
            "target": "components/ui/**/*",
            "from": [
              "components/patterns/**/*",
              "components/sections/**/*",
              "components/templates/**/*"
            ],
            "message": "Primitives cannot import upward. Use tokens or lib/utils only."
          },
          {
            "target": "components/motion/**/*",
            "from": [
              "components/patterns/**/*",
              "components/sections/**/*",
              "components/templates/**/*"
            ],
            "message": "Motion components cannot import upward. Use tokens or lib/utils only."
          },
          {
            "target": "components/patterns/**/*",
            "from": ["components/sections/**/*", "components/templates/**/*"],
            "message": "Patterns cannot import upward (sections or templates)."
          },
          {
            "target": "components/sections/**/*",
            "from": ["components/templates/**/*"],
            "message": "Sections cannot import upward (templates)."
          },
          {
            "target": "components/**/*",
            "from": ["app/**/*"],
            "message": "Components cannot import from app routes. Move shared code to lib/ or components/."
          }
        ]
      }
    ]
  },
  "overrides": [
    {
      "files": ["src/**/*"],
      "rules": {
        "fisk-design-system/no-hardcoded-colors": "error"
      }
    },
    {
      "files": ["src/__tests__/**/*", "**/*.test.ts", "**/*.test.tsx"],
      "rules": {
        "@typescript-eslint/no-explicit-any": "off",
        "@typescript-eslint/no-unused-vars": "off",
        "@typescript-eslint/no-floating-promises": "off",
        "@typescript-eslint/no-misused-promises": "off"
      }
    },
    {
      "files": [
        "src/app/(admin)/**/*.ts",
        "src/app/(admin)/**/*.tsx",
        "src/app/api/admin/**/*.ts",
        "src/app/api/admin/**/*.tsx"
      ],
      "rules": {
        "@typescript-eslint/no-explicit-any": "warn"
      }
    },
    {
      "files": ["src/domain/**/*.ts", "src/domain/**/*.tsx"],
      "rules": {
        "no-restricted-imports": [
          "error",
          {
            "patterns": [
              {
                "group": ["@prisma/*", "@prisma/client"],
                "message": "Domain layer cannot import Prisma. Use repository interfaces."
              },
              {
                "group": ["@/lib/db*", "@/infrastructure/*", "@/application/*", "@/interfaces/*"],
                "message": "Domain layer cannot import from infrastructure, application, or interfaces layers."
              },
              {
                "group": ["next/*", "next"],
                "message": "Domain layer cannot import Next.js. Keep domain pure."
              }
            ]
          }
        ],
        "no-restricted-syntax": [
          "error",
          {
            "selector": "CallExpression[callee.name='parseFloat']",
            "message": "parseFloat banned in domain/application. Use Money.fromString() or Decimal."
          },
          {
            "selector": "CallExpression[callee.object.name='Number'][callee.property.name='parseFloat']",
            "message": "Number.parseFloat banned. Use Money.fromString() or Decimal."
          },
          {
            "selector": "CallExpression[callee.property.name='toFixed']",
            "message": ".toFixed() banned in domain/application. Use Money.format() or Decimal methods."
          }
        ]
      }
    },
    {
      "files": ["src/application/**/*.ts", "src/application/**/*.tsx"],
      "rules": {
        "no-restricted-imports": [
          "error",
          {
            "patterns": [
              {
                "group": ["@prisma/*", "@prisma/client"],
                "message": "Application layer cannot import Prisma. Inject repositories."
              },
              {
                "group": ["@/infrastructure/*", "@/interfaces/*"],
                "message": "Application layer cannot import from infrastructure or interfaces layers."
              }
            ]
          }
        ],
        "no-restricted-syntax": [
          "error",
          {
            "selector": "CallExpression[callee.name='parseFloat']",
            "message": "parseFloat banned in domain/application. Use Money.fromString() or Decimal."
          },
          {
            "selector": "CallExpression[callee.object.name='Number'][callee.property.name='parseFloat']",
            "message": "Number.parseFloat banned. Use Money.fromString() or Decimal."
          },
          {
            "selector": "CallExpression[callee.property.name='toFixed']",
            "message": ".toFixed() banned in domain/application. Use Money.format() or Decimal methods."
          }
        ]
      }
    },
    {
      "files": ["src/components/**/*.ts", "src/components/**/*.tsx"],
      "rules": {
        "no-restricted-imports": [
          "error",
          {
            "patterns": [
              {
                "group": ["@prisma/*", "@prisma/client"],
                "message": "UI components cannot import Prisma directly. Use server actions or API routes."
              },
              {
                "group": ["@/lib/db*"],
                "message": "UI components cannot import database utilities directly."
              },
              {
                "group": ["@/domain/shared/Money", "@/domain/shared/VatRate", "@/domain/tax/*"],
                "message": "UI cannot import domain Money/VAT directly. Use @/interfaces/invoicing/InvoiceDisplayAdapter."
              }
            ]
          }
        ],
        "no-restricted-syntax": [
          "warn",
          {
            "selector": "BinaryExpression[operator='*'][right.property.name='vatRate']",
            "message": "VAT calculation in UI banned. Use calculateLineDisplay() or calculateInvoiceTotals() from InvoiceDisplayAdapter."
          },
          {
            "selector": "BinaryExpression[operator='/'][right.value=100]",
            "message": "Percentage calculation in UI may indicate VAT calc. Use InvoiceDisplayAdapter for money operations."
          },
          {
            "selector": "Literal[value=/^https?:\\/\\/(app|staff|admin)\\.fiskai\\.hr/]",
            "message": "Hardcoded portal URL detected. Use getPortalUrl() from @/lib/portal-urls instead."
          },
          {
            "selector": "TemplateLiteral > TemplateElement[value.raw=/https?:\\/\\/(app|staff|admin)\\.fiskai\\.hr/]",
            "message": "Hardcoded portal URL in template literal. Use getPortalUrl() from @/lib/portal-urls instead."
          }
        ]
      }
    },
    {
      "files": ["src/app/(app)/**/*.ts", "src/app/(app)/**/*.tsx"],
      "rules": {
        "no-restricted-imports": [
          "error",
          {
            "patterns": [
              {
                "group": ["@/domain/shared/Money", "@/domain/shared/VatRate", "@/domain/tax/*"],
                "message": "App routes cannot import domain Money/VAT directly. Use @/interfaces/invoicing/InvoiceDisplayAdapter."
              }
            ]
          }
        ],
        "no-restricted-syntax": [
          "warn",
          {
            "selector": "BinaryExpression[operator='*'][right.property.name='vatRate']",
            "message": "VAT calculation in UI banned. Use calculateLineDisplay() or calculateInvoiceTotals() from InvoiceDisplayAdapter."
          },
          {
            "selector": "BinaryExpression[operator='/'][right.value=100]",
            "message": "Percentage calculation in UI may indicate VAT calc. Use InvoiceDisplayAdapter for money operations."
          }
        ]
      }
    },
    {
      "files": ["src/lib/regulatory-truth/**/*.ts", "src/lib/regulatory-truth/**/*.tsx"],
      "rules": {
        "no-restricted-imports": [
          "warn",
          {
            "paths": [
              {
                "name": "@/lib/db",
                "importNames": ["db", "prisma"],
                "message": "RTL modules should prefer dbReg for Evidence/EvidenceArtifact/MonitoringAlert/etc. Use db for RegulatoryRule/RuleVersion until batch 2+ migration."
              }
            ]
          }
        ]
      }
    },
    {
      "files": ["src/**/*.ts", "src/**/*.tsx"],
      "excludedFiles": [
        "src/lib/fiscal-rules/**/*",
        "src/lib/rules/applied-rule-snapshot-service.ts"
      ],
      "rules": {
        "no-restricted-syntax": [
          "error",
          {
            "selector": "Property[key.name='include'] ObjectExpression > Property[key.name='ruleVersion']",
            "message": "Forbidden: include.ruleVersion. Use AppliedRuleSnapshot via snapshot-reader. (PR#9)"
          },
          {
            "selector": "Property[key.name='select'] ObjectExpression > Property[key.name='ruleVersion']",
            "message": "Forbidden: select.ruleVersion. Use AppliedRuleSnapshot via snapshot-reader. (PR#9)"
          },
          {
            "selector": "MemberExpression[property.name='ruleVersion']",
            "message": "Forbidden: accessing .ruleVersion. Use AppliedRuleSnapshot (appliedRuleSnapshot / snapshot-reader). (PR#9)"
          }
        ]
      }
    },
    {
      "files": ["src/**/*.test.ts", "src/**/*.spec.ts", "src/**/*.test.tsx", "src/**/*.spec.tsx"],
      "rules": {
        "no-restricted-syntax": "off"
      }
    },
    {
      "files": [
        "src/app/(marketing)/**/*.ts",
        "src/app/(marketing)/**/*.tsx",
        "src/components/marketing/**/*.ts",
        "src/components/marketing/**/*.tsx"
      ],
      "excludedFiles": [
        "src/app/(marketing)/**/opengraph-image.tsx",
        "src/app/(marketing)/**/opengraph-image.ts"
      ],
      "rules": {
        "no-restricted-imports": [
          "error",
          {
            "patterns": [
              {
                "group": ["@/lib/auth", "@/lib/auth/**"],
                "message": "STATIC EXPORT VIOLATION: Marketing cannot import auth utilities. Auth lives on app.fiskai.hr only."
              },
              {
                "group": ["drizzle-orm", "drizzle-orm/**"],
                "message": "STATIC EXPORT VIOLATION: Marketing cannot import Drizzle ORM. No database at runtime."
              },
              {
                "group": ["@/lib/db", "@/lib/db/**"],
                "message": "STATIC EXPORT VIOLATION: Marketing cannot import database utilities. No database at runtime."
              },
              {
                "group": ["@prisma/client", "@prisma/*"],
                "message": "STATIC EXPORT VIOLATION: Marketing cannot import Prisma. No database at runtime."
              },
              {
                "group": ["next/server"],
                "message": "STATIC EXPORT VIOLATION: Marketing cannot import next/server. Static export has no server."
              },
              {
                "group": ["@/app/actions", "@/app/actions/**"],
                "message": "STATIC EXPORT VIOLATION: Marketing cannot import server actions. Static export has no server."
              },
              {
                "group": ["next/headers"],
                "message": "STATIC EXPORT VIOLATION: Marketing cannot use next/headers. No server to read headers from."
              },
              {
                "group": ["fs", "fs/*", "path", "child_process"],
                "message": "STATIC EXPORT VIOLATION: Marketing cannot use Node.js filesystem APIs. Runs in browser only."
              }
            ],
            "paths": [
              {
                "name": "next/cache",
                "message": "STATIC EXPORT VIOLATION: Marketing cannot use next/cache. No server for revalidation."
              }
            ]
          }
        ],
        "no-restricted-syntax": [
          "error",
          {
            "selector": "ExpressionStatement > Literal[value='use server']",
            "message": "STATIC EXPORT VIOLATION: Marketing cannot use 'use server' directive. Static export has no server."
          },
          {
            "selector": "ExportNamedDeclaration > VariableDeclaration > VariableDeclarator[id.name='dynamic'][init.value='force-dynamic']",
            "message": "STATIC EXPORT VIOLATION: Marketing cannot use force-dynamic. Must be statically renderable."
          },
          {
            "selector": "Identifier[name='Buffer']",
            "message": "STATIC EXPORT VIOLATION: Marketing cannot use Node.js Buffer. Runs in browser only."
          }
        ]
      }
    }
  ]
}
