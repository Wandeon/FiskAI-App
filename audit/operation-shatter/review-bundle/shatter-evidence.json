{
  "run": {
    "startedAt": "2026-01-02T12:23:31.036Z",
    "databaseUrl": "postgresql://fiskai:fiskai_secret_2025@localhost:5434/fiskai_shatter?schema=public",
    "deterministicMode": true
  },
  "actor": {
    "userId": "cmjwuhszn0000y1wa5e9tikrq",
    "companyId": "cmjwuht2p0001y1waapq8r3ph"
  },
  "scenarios": {
    "SHATTER-S1": {
      "correlationId": "SHATTER-S1",
      "steps": [
        {
          "step": "S1.Invoice1 create + PDF",
          "input": {
            "buyer": {
              "name": "EU Client GmbH",
              "vatNumber": "DE123456789",
              "country": "DE"
            },
            "invoice": {
              "issueDate": "2026-01-05T00:00:00.000Z",
              "invoiceNumber": "1-1-1"
            },
            "lines": [
              {
                "description": "Consulting",
                "quantity": 1,
                "unitPrice": 1000,
                "vatRate": 0
              }
            ]
          },
          "process": [
            {
              "file": "src/lib/invoice-numbering.ts",
              "fn": "getNextInvoiceNumber"
            },
            {
              "file": "src/lib/vat/output-calculator.ts",
              "fn": "buildVatLineTotals"
            },
            {
              "file": "scripts/operation-shatter.ts",
              "fn": "db.eInvoice.create"
            },
            {
              "file": "src/lib/pdf/generate-invoice-pdf-artifact.ts",
              "fn": "generateInvoicePdfArtifact"
            }
          ],
          "evidence": {
            "rows": [
              {
                "model": "EInvoice",
                "id": "cmjwuhtb3000cy1wand8hmwut",
                "fields": {
                  "invoiceNumber": "1-1-1",
                  "status": "SENT"
                }
              },
              {
                "model": "EInvoiceLine",
                "id": "cmjwuhtb9000dy1warz4g289l",
                "fields": {
                  "vatRate": "0.00",
                  "vatAmount": "0.00"
                }
              }
            ],
            "artifacts": [
              {
                "id": "cmjwuhtw7000gy1wa331d7nu0",
                "type": "PDF",
                "fileName": "racun-1-1-1.pdf",
                "checksum": "9aab3a9e4e644214de81ab8b7446fbc0bddd6ae3edde58c3a451312a48135c18",
                "storageKey": "attachments/cmjwuht2p0001y1waapq8r3ph/2000/01/c2f1a771_9aab3a9e4e644214de81ab8b7446fbc0bddd6ae3edde58c3a451312a48135c18.pdf",
                "generatorVersion": "invoice-pdf@1",
                "inputHash": "b2110d9de223e5f6bd3a8345d4c6322b854af38d7bf8e46eb8ddf144bebc9555"
              }
            ],
            "notes": {
              "pdfContainsReverseChargeNote": true
            }
          }
        },
        {
          "step": "S1.Invoice2 fiscalize + sabotage + credit note",
          "input": {
            "invoice2": {
              "invoiceNumber": "2-1-1",
              "totalAmount": "230.00"
            },
            "fiscalize": {
              "demo": true,
              "paymentMethod": "CASH"
            },
            "sabotage": {
              "update": {
                "totalAmount": "1.00"
              }
            },
            "creditNote": {
              "correctsInvoiceId": "cmjwuhul6000qy1wad9tbh2yp",
              "fullRefund": true
            }
          },
          "process": [
            {
              "file": "src/lib/fiscal/pos-fiscalize.ts",
              "fn": "fiscalizePosSale"
            },
            {
              "file": "src/lib/prisma-extensions.ts",
              "fn": "enforceInvoiceImmutability"
            },
            {
              "file": "scripts/operation-shatter.ts",
              "fn": "db.eInvoice.create (CREDIT_NOTE)"
            }
          ],
          "evidence": {
            "rows": [
              {
                "model": "EInvoice",
                "id": "cmjwuhul6000qy1wad9tbh2yp",
                "fields": {
                  "jir": "DEMO-bebf16e0b025a17ce21924eac58c65bf",
                  "fiscalizedAt": "2026-01-02T12:23:33.460Z"
                }
              },
              {
                "model": "EInvoice",
                "id": "cmjwuhut1000yy1waif8n1kxc",
                "fields": {
                  "correctsInvoiceId": "cmjwuhul6000qy1wad9tbh2yp",
                  "totalAmount": "-230.00"
                }
              }
            ],
            "notes": {
              "sabotageError": "InvoiceImmutabilityError: Issued invoices are immutable. Attempted to update fields [totalAmount] on invoice in status PENDING_FISCALIZATION. Use a credit note for corrections."
            }
          }
        }
      ],
      "auditLogIds": [
        "cmjwuht5v0005y1wa305falaq",
        "cmjwuht8w0009y1wak2my2ass",
        "cmjwuht9b000ay1wanor2k0et",
        "cmjwuht9u000by1wae0as81xh",
        "cmjwuhtc8000ey1wadzpsp0s9",
        "cmjwuhtwr000iy1wapbiwlia0",
        "cmjwuhtwm000hy1waxkktdyh5",
        "cmjwuhu9v000ly1wagzc51k11",
        "cmjwuhu9n000ky1wa21f7sv19",
        "cmjwuhujc000ny1wae98v3r63",
        "cmjwuhuk1000py1wa6pmu6atx",
        "cmjwuhunj000ty1wab0adkbr3",
        "cmjwuhup5000uy1wa02caqsd8",
        "cmjwuhuqn000vy1wa0qk67nef",
        "cmjwuhus6000xy1wa7h4jvq8i",
        "cmjwuhutv0011y1waxbz5sv5r"
      ],
      "entityIds": {
        "Contact": ["cmjwuht450004y1wahn3wgum3", "cmjwuhuj0000my1wa2y7133fe"],
        "EInvoice": [
          "cmjwuhtb3000cy1wand8hmwut",
          "cmjwuhul6000qy1wad9tbh2yp",
          "cmjwuhut1000yy1waif8n1kxc"
        ],
        "Artifact": ["cmjwuhtw7000gy1wa331d7nu0", "cmjwuhu9c000jy1waz6ad5fsy"]
      },
      "artifacts": [
        {
          "id": "cmjwuhtw7000gy1wa331d7nu0",
          "type": "PDF",
          "fileName": "racun-1-1-1.pdf",
          "checksum": "9aab3a9e4e644214de81ab8b7446fbc0bddd6ae3edde58c3a451312a48135c18",
          "storageKey": "attachments/cmjwuht2p0001y1waapq8r3ph/2000/01/c2f1a771_9aab3a9e4e644214de81ab8b7446fbc0bddd6ae3edde58c3a451312a48135c18.pdf",
          "generatorVersion": "invoice-pdf@1",
          "inputHash": "b2110d9de223e5f6bd3a8345d4c6322b854af38d7bf8e46eb8ddf144bebc9555"
        },
        {
          "id": "cmjwuhu9c000jy1waz6ad5fsy",
          "type": "PDF",
          "fileName": "racun-1-1-1.pdf",
          "checksum": "9aab3a9e4e644214de81ab8b7446fbc0bddd6ae3edde58c3a451312a48135c18",
          "storageKey": "attachments/cmjwuht2p0001y1waapq8r3ph/2000/01/c2f1a771_9aab3a9e4e644214de81ab8b7446fbc0bddd6ae3edde58c3a451312a48135c18.pdf",
          "generatorVersion": "invoice-pdf@1",
          "inputHash": "b2110d9de223e5f6bd3a8345d4c6322b854af38d7bf8e46eb8ddf144bebc9555"
        }
      ],
      "assertions": [
        {
          "name": "S1.Invoice1 VAT is 0%",
          "pass": true,
          "details": "EInvoice.vatAmount=0.00"
        },
        {
          "name": "H4.Invoice1 PDF checksum reproducible",
          "pass": true,
          "details": "checksumA=9aab3a9e4e644214de81ab8b7446fbc0bddd6ae3edde58c3a451312a48135c18 checksumB=9aab3a9e4e644214de81ab8b7446fbc0bddd6ae3edde58c3a451312a48135c18"
        },
        {
          "name": "S1.Invoice1 PDF contains reverse-charge note",
          "pass": true,
          "details": "contains=true"
        },
        {
          "name": "S1.Invoice2 fiscalize success (mock/demo)",
          "pass": true,
          "details": "success=true jir=DEMO-bebf16e0b025a17ce21924eac58c65bf"
        },
        {
          "name": "S1.Sabotage update is blocked",
          "pass": true,
          "details": "InvoiceImmutabilityError: Issued invoices are immutable. Attempted to update fields [totalAmount] on invoice in status PENDING_FISCALIZATION. Use a credit note for corrections."
        },
        {
          "name": "S1.Sabotage caused no DB mutation",
          "pass": true,
          "details": "before=230.00 after=230.00"
        },
        {
          "name": "S1.Credit note created as new record (original untouched)",
          "pass": true,
          "details": "credit.correctsInvoiceId=cmjwuhul6000qy1wad9tbh2yp original.id=cmjwuhul6000qy1wad9tbh2yp"
        }
      ]
    },
    "SHATTER-S2": {
      "correlationId": "SHATTER-S2",
      "steps": [
        {
          "step": "S2.Expense→Asset→MonthClose→Lock",
          "input": {
            "expense": {
              "vendor": "Links d.o.o.",
              "item": "MacBook Pro M3",
              "net": "2500.00",
              "vat": "625.00",
              "total": "3125.00"
            },
            "depreciation": {
              "usefulLifeMonths": 24,
              "expectedMonth1": "104.16"
            },
            "monthClose": {
              "month": "2026-01"
            },
            "sabotage": {
              "expenseUpdateDescription": "Tampered"
            }
          },
          "process": [
            {
              "file": "src/lib/fixed-assets/asset-candidates.ts",
              "fn": "emitAssetCandidates"
            },
            {
              "file": "src/lib/fixed-assets/conversion.ts",
              "fn": "convertFixedAssetCandidateToAsset"
            },
            {
              "file": "src/lib/assets/depreciation.ts",
              "fn": "postDepreciationEntriesForPeriod"
            },
            {
              "file": "src/lib/month-close/service.ts",
              "fn": "runMonthClose"
            }
          ],
          "evidence": {
            "rows": [
              {
                "model": "Expense",
                "id": "cmjwuhuv10017y1waff8qtmve",
                "fields": {
                  "totalAmount": "3125.00",
                  "status": "PENDING"
                }
              },
              {
                "model": "FixedAssetCandidate",
                "id": "cmjwuhuxu001ey1wamsiqiluj",
                "fields": {
                  "status": "PENDING",
                  "amount": "3125.00",
                  "thresholdValue": "464.53"
                }
              },
              {
                "model": "FixedAsset",
                "id": "cmjwuhuz2001fy1waz72vlk4g",
                "fields": {
                  "acquisitionCost": "2500.00",
                  "usefulLifeMonths": 24
                }
              },
              {
                "model": "AccountingPeriod",
                "id": "cmjwuhv3j0027y1waimphmkev",
                "fields": {
                  "status": "LOCKED",
                  "startDate": "2025-12-31T23:00:00.000Z"
                }
              }
            ],
            "notes": {
              "lockError": "AccountingPeriodLockedError: Cannot modify Expense on 2026-01-10T00:00:00.000Z: accounting period is locked."
            }
          }
        }
      ],
      "auditLogIds": [
        "cmjwuhuur0015y1waqsguvckg",
        "cmjwuhuux0016y1wad21422qm",
        "cmjwuhuvo0018y1wajrefblry",
        "cmjwuhuwv001by1wa27pogz0n",
        "cmjwuhuxk001dy1wa8z2b4gdp",
        "cmjwuhv2x0026y1wargh1mb01",
        "cmjwuhv530029y1wazfhomlax",
        "cmjwuhv4y0028y1wanu884g47",
        "cmjwuhv97002ey1wa0wm3m6rt",
        "cmjwuhv93002dy1wa6hm3nje3",
        "cmjwuhva3002fy1waghbgaapx"
      ],
      "entityIds": {
        "Contact": ["cmjwuhuuk0013y1wal3cuyn5k"],
        "ExpenseCategory": ["cmjwuhuup0014y1waf0txy5ka"],
        "Expense": ["cmjwuhuv10017y1waff8qtmve"],
        "ExpenseLine": ["cmjwuhuwg001ay1wak4oz1gjl"],
        "UraInput": ["cmjwuhux9001cy1wa1frucqyb"],
        "FixedAssetCandidate": ["cmjwuhuxu001ey1wamsiqiluj"],
        "FixedAsset": ["cmjwuhuz2001fy1waz72vlk4g"],
        "DepreciationSchedule": ["cmjwuhv1b001hy1wah52frs8i"]
      },
      "artifacts": [],
      "assertions": [
        {
          "name": "S2.Expense flagged as asset candidate",
          "pass": true,
          "details": "fixedAssetCandidate.count=1 threshold>1000"
        },
        {
          "name": "S2.Depreciation month1 posts 104.16",
          "pass": true,
          "details": "amount=104.16"
        },
        {
          "name": "S2.Month close locked period",
          "pass": true,
          "details": "period.status=LOCKED"
        },
        {
          "name": "S2.Journal entry posted 104.16",
          "pass": true,
          "details": "lines=1:104.16/0.00,2:0.00/104.16"
        },
        {
          "name": "S2.Locked period blocks expense update",
          "pass": true,
          "details": "AccountingPeriodLockedError: Cannot modify Expense on 2026-01-10T00:00:00.000Z: accounting period is locked."
        }
      ]
    },
    "SHATTER-S3": {
      "correlationId": "SHATTER-S3",
      "steps": [
        {
          "step": "S3.Import + AutoMatch",
          "input": {
            "invoices": [
              {
                "id": "cmjwuhvec002oy1wanqhk2qd7",
                "invoiceNumber": "4-1-1",
                "total": "100.00"
              },
              {
                "id": "cmjwuhvfm002sy1wa4d30qb4h",
                "invoiceNumber": "5-1-1",
                "total": "100.00"
              }
            ],
            "transactions": [
              {
                "amount": "98.00",
                "reference": null
              },
              {
                "amount": "102.00",
                "reference": "5-1-1"
              },
              {
                "amount": "-5.00",
                "description": "Bank naknada"
              }
            ]
          },
          "process": [
            {
              "file": "src/lib/banking/import/import-parsed.ts",
              "fn": "importParsedBankTransactions"
            },
            {
              "file": "src/lib/banking/reconciliation-service.ts",
              "fn": "runAutoMatchTransactions"
            }
          ],
          "evidence": {
            "rows": [
              {
                "model": "StatementImport",
                "id": "cmjwuhvh4002wy1waa6sxcx00",
                "fields": {
                  "fileChecksum": "244b696ca1f344a69232767b9a7c92251248722f63a7110ea8753397eeeb204c"
                }
              },
              {
                "model": "EInvoice",
                "id": "cmjwuhvec002oy1wanqhk2qd7",
                "fields": {
                  "paymentStatus": "PARTIAL",
                  "paidAmount": "98.00"
                }
              },
              {
                "model": "EInvoice",
                "id": "cmjwuhvfm002sy1wa4d30qb4h",
                "fields": {
                  "paymentStatus": "PAID",
                  "paidAmount": "100.00"
                }
              },
              {
                "model": "BankTransaction",
                "id": "cmjwuhvi30030y1wa8ge3ntw2",
                "fields": {
                  "amount": "-5.00",
                  "matchStatus": "AUTO_MATCHED"
                }
              },
              {
                "model": "BankTransaction",
                "id": "cmjwuhvi3002yy1waopb3382n",
                "fields": {
                  "amount": "98.00",
                  "matchStatus": "AUTO_MATCHED"
                }
              },
              {
                "model": "BankTransaction",
                "id": "cmjwuhvi3002zy1wai95vshw4",
                "fields": {
                  "amount": "102.00",
                  "matchStatus": "AUTO_MATCHED"
                }
              }
            ],
            "notes": {
              "matchRes": {
                "matchedCount": 3,
                "evaluated": 3
              }
            }
          }
        }
      ],
      "auditLogIds": [
        "cmjwuhvbd002iy1wa9h32fzhc",
        "cmjwuhvbn002jy1waupo5al2o",
        "cmjwuhvcs002ly1waztqu2z77",
        "cmjwuhvds002ny1wa9wxed68h",
        "cmjwuhvew002qy1wa8042xdbn",
        "cmjwuhvg8002uy1wam9klqdf8",
        "cmjwuhvhj002xy1wa3md8s7lo",
        "cmjwuhvk40032y1wavaa0xxbf",
        "cmjwuhvko0034y1wa1xkl6o5q",
        "cmjwuhvme003ay1wajb5tyj6i",
        "cmjwuhvmp003by1wao8ykf2ud",
        "cmjwuhvmw003cy1wa7r9g0kji",
        "cmjwuhvqf003dy1wa5bxa4397",
        "cmjwuhvr7003ey1wa9t11f432"
      ],
      "entityIds": {
        "BankAccount": ["cmjwuhvaz002gy1wabcg1sgps"],
        "Contact": ["cmjwuhvb9002hy1wayri7as55"],
        "EInvoice": ["cmjwuhvec002oy1wanqhk2qd7", "cmjwuhvfm002sy1wa4d30qb4h"],
        "UnappliedPayment": ["cmjwuhvld0038y1warpz4qwvo"],
        "Expense": ["cmjwuhvk90033y1waa9a152dc"],
        "BankTransaction": [
          "cmjwuhvi30030y1wa8ge3ntw2",
          "cmjwuhvi3002yy1waopb3382n",
          "cmjwuhvi3002zy1wai95vshw4"
        ]
      },
      "artifacts": [],
      "assertions": [
        {
          "name": "S3.Invoice A PARTIAL remaining 2",
          "pass": true,
          "details": "paymentStatus=PARTIAL paidAmount=98.00"
        },
        {
          "name": "S3.Invoice B PAID with overpayment 2",
          "pass": true,
          "details": "paymentStatus=PAID paidAmount=100.00"
        },
        {
          "name": "S3.Overpayment stored as UnappliedPayment 2.00",
          "pass": true,
          "details": "unappliedPayment.id=cmjwuhvld0038y1warpz4qwvo"
        },
        {
          "name": "S3.Bank fee categorized to Bankarske usluge",
          "pass": true,
          "details": "expense.id=cmjwuhvk90033y1waa9a152dc category=Bankarske usluge"
        }
      ]
    },
    "SHATTER-S4": {
      "correlationId": "SHATTER-S4",
      "steps": [
        {
          "step": "S4.Payroll→JOPPD→PDV",
          "input": {
            "payout": {
              "gross": "3000.00",
              "postalCode": "10000"
            },
            "ruleVersionIds": {
              "CONTRIBUTIONS": "cmjwuhvwx003fy1wa30q02duz",
              "INCOME_TAX": "cmjwuhvxw003hy1war7pdtc9z",
              "MUNICIPALITY_INCOME_TAX": "cmjwuhvyf003jy1waxwklges6",
              "JOPPD_CODEBOOK": "cmjwuhvz4003ly1wa7tfnhi8q"
            },
            "joppd": {
              "mockSigning": true,
              "retentionYears": 11,
              "submissionId": "0752f8dd-ca8e-47a2-a854-105a359819fa"
            },
            "sabotage": {
              "updateSignedKeyToNull": true,
              "deleteSubmission": true
            },
            "pdv": {
              "dateFrom": "2026-01-01T00:00:00.000Z",
              "dateTo": "2026-01-31T23:59:59.999Z"
            }
          },
          "process": [
            {
              "file": "src/lib/payroll/director-salary.ts",
              "fn": "computeDirectorSalaryPayroll"
            },
            {
              "file": "src/lib/joppd/joppd-service.ts",
              "fn": "prepareJoppdSubmission"
            },
            {
              "file": "src/lib/reports/pdv-xml-artifact.ts",
              "fn": "generatePdvXmlArtifact"
            }
          ],
          "evidence": {
            "rows": [
              {
                "model": "Payout",
                "id": "8ed9135f-589a-4807-9e7e-703045bc59c4",
                "fields": {
                  "status": "REPORTED",
                  "periodMonth": 2
                }
              },
              {
                "model": "CalculationSnapshot",
                "id": "515e8872-6fb4-41e6-b333-032e4baadd81",
                "fields": {
                  "rulesEngineSnapshot": {
                    "kind": "OPERATION_SHATTER_DIRECTOR_SALARY",
                    "pinnedRuleVersions": {
                      "INCOME_TAX": "cmjwuhvxw003hy1war7pdtc9z",
                      "CONTRIBUTIONS": "cmjwuhvwx003fy1wa30q02duz",
                      "MUNICIPALITY_INCOME_TAX": "cmjwuhvyf003jy1waxwklges6"
                    }
                  }
                }
              },
              {
                "model": "JoppdSubmission",
                "id": "0752f8dd-ca8e-47a2-a854-105a359819fa",
                "fields": {
                  "status": "ACCEPTED",
                  "signedXmlHash": "0a5fc771a441eb277f9f6264d50ebb5e818065a0897977942da9613f82267ff8",
                  "signedXmlStorageKey": "attachments/cmjwuht2p0001y1waapq8r3ph/2000/01/a492c3f6_0a5fc771a441eb277f9f6264d50ebb5e818065a0897977942da9613f82267ff8.xml"
                }
              }
            ],
            "artifacts": [
              {
                "id": "cmjwuhw71003oy1wax3g86aaq",
                "type": "XML",
                "fileName": "joppd-39168380555-2026-02-8ed9135f-589a-4807-9e7e-703045bc59c4.xml",
                "checksum": "0a5fc771a441eb277f9f6264d50ebb5e818065a0897977942da9613f82267ff8",
                "storageKey": "attachments/cmjwuht2p0001y1waapq8r3ph/2000/01/a492c3f6_0a5fc771a441eb277f9f6264d50ebb5e818065a0897977942da9613f82267ff8.xml",
                "generatorVersion": "joppd-xml@1",
                "inputHash": "e0686f727736fb33e8e236eb6c292bd1ed336c965391638880f95e7471030bba"
              },
              {
                "id": "cmjwuhwdz003wy1waw7cujyqi",
                "type": "XML",
                "fileName": "PDV-39168380555-2026-01.xml",
                "checksum": "76bc51347f51fde41e923dbdf32b951c5150c60642b2accfccf2706d5606a2ec",
                "storageKey": "attachments/cmjwuht2p0001y1waapq8r3ph/2000/01/0561bd19_76bc51347f51fde41e923dbdf32b951c5150c60642b2accfccf2706d5606a2ec.xml",
                "generatorVersion": "pdv-xml@1",
                "inputHash": "64c1f7ca791e1e06fbb421b39462219bd5cdc255fd69948227e5f1e0c5dfcf67"
              }
            ],
            "notes": {
              "joppdAttackError": "JoppdImmutabilityError: JOPPD submissions are immutable after signing/submission. Attempted to update fields [signedXmlStorageKey] on JOPPD in status ACCEPTED. Signed/submitted JOPPD records cannot be modified. Use a correction submission instead.",
              "joppdDeleteError": "JoppdImmutabilityError: JOPPD submissions are immutable after signing/submission. Cannot delete JOPPD in status ACCEPTED. Signed/submitted JOPPD records are immutable. Use a correction submission instead.",
              "pdv": {
                "section1": {
                  "domestic": {
                    "standard": {
                      "rate": 25,
                      "baseAmount": "0.00",
                      "vatAmount": "0.00"
                    },
                    "reduced": {
                      "rate": 13,
                      "baseAmount": "0.00",
                      "vatAmount": "0.00"
                    },
                    "superReduced": {
                      "rate": 5,
                      "baseAmount": "0.00",
                      "vatAmount": "0.00"
                    }
                  },
                  "euDeliveries": {
                    "goods": "0.00",
                    "services": "1000.00"
                  },
                  "exports": "0.00",
                  "exempt": "0.00",
                  "totalOutputVat": "0.00",
                  "totalBaseOutput": "1000.00"
                },
                "section2": {
                  "domestic": {
                    "standard": {
                      "rate": 25,
                      "baseAmount": "2500.00",
                      "vatAmount": "625.00"
                    },
                    "reduced": {
                      "rate": 13,
                      "baseAmount": "0.00",
                      "vatAmount": "0.00"
                    },
                    "superReduced": {
                      "rate": 5,
                      "baseAmount": "0.00",
                      "vatAmount": "0.00"
                    }
                  },
                  "euAcquisitions": {
                    "goods": {
                      "rate": 25,
                      "baseAmount": "0.00",
                      "vatAmount": "0.00"
                    },
                    "services": {
                      "rate": 25,
                      "baseAmount": "0.00",
                      "vatAmount": "0.00"
                    }
                  },
                  "imports": {
                    "rate": 25,
                    "baseAmount": "0.00",
                    "vatAmount": "0.00"
                  },
                  "nonDeductible": "0.00",
                  "totalInputVat": "625.00",
                  "totalBaseInput": "2500.00"
                },
                "section3": {
                  "outputVat": "0.00",
                  "inputVat": "625.00",
                  "vatPayable": "-625.00"
                }
              }
            }
          }
        }
      ],
      "auditLogIds": [
        "cmjwuhw7g003qy1waipxr9odi",
        "cmjwuhw7b003py1wa6qb40tdr",
        "cmjwuhw9l003ty1wassljwqc6",
        "cmjwuhw9i003sy1wa4mobxe4x",
        "cmjwuhwbs003uy1wa6qvc4f2v",
        "cmjwuhwc3003vy1way218kdyx",
        "cmjwuhwe8003yy1wacrkdnji9",
        "cmjwuhwe5003xy1waavio9cny",
        "cmjwuhwf60040y1wanx33l2wc",
        "cmjwuhwf90041y1watvmq11g9"
      ],
      "entityIds": {
        "RuleVersion": [
          "cmjwuhvwx003fy1wa30q02duz",
          "cmjwuhvxw003hy1war7pdtc9z",
          "cmjwuhvyf003jy1waxwklges6",
          "cmjwuhvz4003ly1wa7tfnhi8q"
        ],
        "Payout": ["8ed9135f-589a-4807-9e7e-703045bc59c4"],
        "PayoutLine": ["d3d99f2c-6576-4955-bd66-469a9ff8ba98"],
        "CalculationSnapshot": ["515e8872-6fb4-41e6-b333-032e4baadd81"],
        "JoppdSubmission": [
          "0752f8dd-ca8e-47a2-a854-105a359819fa",
          "9382924a-1342-4887-a955-6f8959a49d52"
        ],
        "Artifact": [
          "cmjwuhw71003oy1wax3g86aaq",
          "cmjwuhwdz003wy1waw7cujyqi",
          "cmjwuhwez003zy1wa6pmgvru7"
        ]
      },
      "artifacts": [
        {
          "id": "cmjwuhw71003oy1wax3g86aaq",
          "type": "XML",
          "fileName": "joppd-39168380555-2026-02-8ed9135f-589a-4807-9e7e-703045bc59c4.xml",
          "checksum": "0a5fc771a441eb277f9f6264d50ebb5e818065a0897977942da9613f82267ff8",
          "storageKey": "attachments/cmjwuht2p0001y1waapq8r3ph/2000/01/a492c3f6_0a5fc771a441eb277f9f6264d50ebb5e818065a0897977942da9613f82267ff8.xml",
          "generatorVersion": "joppd-xml@1",
          "inputHash": "e0686f727736fb33e8e236eb6c292bd1ed336c965391638880f95e7471030bba"
        },
        {
          "id": "cmjwuhwdz003wy1waw7cujyqi",
          "type": "XML",
          "fileName": "PDV-39168380555-2026-01.xml",
          "checksum": "76bc51347f51fde41e923dbdf32b951c5150c60642b2accfccf2706d5606a2ec",
          "storageKey": "attachments/cmjwuht2p0001y1waapq8r3ph/2000/01/0561bd19_76bc51347f51fde41e923dbdf32b951c5150c60642b2accfccf2706d5606a2ec.xml",
          "generatorVersion": "pdv-xml@1",
          "inputHash": "64c1f7ca791e1e06fbb421b39462219bd5cdc255fd69948227e5f1e0c5dfcf67"
        },
        {
          "id": "cmjwuhwez003zy1wa6pmgvru7",
          "type": "XML",
          "fileName": "PDV-39168380555-2026-01.xml",
          "checksum": "76bc51347f51fde41e923dbdf32b951c5150c60642b2accfccf2706d5606a2ec",
          "storageKey": "attachments/cmjwuht2p0001y1waapq8r3ph/2000/01/0561bd19_76bc51347f51fde41e923dbdf32b951c5150c60642b2accfccf2706d5606a2ec.xml",
          "generatorVersion": "pdv-xml@1",
          "inputHash": "64c1f7ca791e1e06fbb421b39462219bd5cdc255fd69948227e5f1e0c5dfcf67"
        }
      ],
      "assertions": [
        {
          "name": "H4.JOPPD XML checksum reproducible for same payout inputs",
          "pass": true,
          "details": "hash1=0a5fc771a441eb277f9f6264d50ebb5e818065a0897977942da9613f82267ff8 hash2=0a5fc771a441eb277f9f6264d50ebb5e818065a0897977942da9613f82267ff8"
        },
        {
          "name": "S4.Sabotage update blocked for submitted JOPPD",
          "pass": true,
          "details": "JoppdImmutabilityError: JOPPD submissions are immutable after signing/submission. Attempted to update fields [signedXmlStorageKey] on JOPPD in status ACCEPTED. Signed/submitted JOPPD records cannot be modified. Use a correction submission instead."
        },
        {
          "name": "S4.Sabotage delete blocked for submitted JOPPD",
          "pass": true,
          "details": "JoppdImmutabilityError: JOPPD submissions are immutable after signing/submission. Cannot delete JOPPD in status ACCEPTED. Signed/submitted JOPPD records are immutable. Use a correction submission instead."
        },
        {
          "name": "H4.PDV XML checksum reproducible",
          "pass": true,
          "details": "checksumA=76bc51347f51fde41e923dbdf32b951c5150c60642b2accfccf2706d5606a2ec checksumB=76bc51347f51fde41e923dbdf32b951c5150c60642b2accfccf2706d5606a2ec"
        },
        {
          "name": "S4.PDV excludes EU reverse charge from domestic output VAT",
          "pass": true,
          "details": "{\"euServices\":\"1000.00\",\"outStandardBase\":\"0.00\",\"outSuperReducedBase\":\"0.00\"}"
        },
        {
          "name": "S4.PDV input VAT includes 625.00 from MacBook",
          "pass": true,
          "details": "inVat25=625.00"
        },
        {
          "name": "S4.PDV control sum (output - input = payable)",
          "pass": true,
          "details": "{\"outputVat\":\"0.00\",\"inputVat\":\"625.00\",\"vatPayable\":\"-625.00\"}"
        }
      ]
    }
  },
  "commands": [
    "DATABASE_URL='postgresql://fiskai:fiskai_secret_2025@localhost:5434/fiskai_shatter?schema=public' npx tsx scripts/operation-shatter.ts"
  ]
}
